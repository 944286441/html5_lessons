<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
	#myCanvas{
		box-shadow: 0px 0px 10px black;
	}
	</style>
</head>
<body>
	<canvas id="myCanvas" width="500" height="500">
		您的浏览器不支持canvas
	</canvas>
</body>
<script type="text/javascript">
	var canvas = document.querySelector("#myCanvas");
	var ctx = canvas.getContext("2d");
	var canvasWidth = canvas.width;
	var canvasHeight = canvas.height;

	var timer = null;

	function rand(min,max){
		if (max>min){
			return parseInt(Math.random()*(max-min)+1)+min;
		}
	}

	function collide(obj1,obj2){
			
		var l1 = obj1.x;
		var r1 = l1+obj1.w;
		var t1 = obj1.y;
		var b1 = t1+obj1.h;
		
		var l2 = obj2.x;
		var r2 = l2+obj2.w;
		var t2 = obj2.y;
		var b2 = t2+obj2.h;
		
		if (r1>l2&&l1<r2&&b1>t2&&t1<b2){
			return true;
		}else{
			return false;
		}
	}

	var snake = {
		w:40,
		h:40,
		x:-40,
		y:0,
		speed:500,
		color:"red",
		l:false,
		t:false,
		r:true,
		b:false,
		//蛇的身体
		bodys:[],
		//控制是否删除身体
		removeBody:true
	}
	snake.move = function (){

		ctx.fillStyle = "#ccc";
		for (var i=0; i<this.bodys.length; i++){
			var nowBody = this.bodys[i];
			ctx.fillRect(nowBody.x,nowBody.y,nowBody.w,nowBody.h);
		}

		if (this.l){
			this.x -= this.w;
		}else if(this.r){
			this.x += this.w;
		}else if(this.t){
			this.y -= this.h;
		}else if(this.b){
			this.y += this.h;
		}

		var snakeBody = {
			w:40,
			h:40,
			x:this.x,
			y:this.y
		}
		this.bodys.push(snakeBody);
		if (this.bodys.length > 6 && this.removeBody){
			this.bodys.shift();
		}else{
			this.removeBody = true;
		}
		
	}
	snake.draw = function (){
		
		ctx.fillStyle = this.color;
		ctx.fillRect(this.x, this.y, this.w, this.h);
	}

	function Food(){
		var size = rand(20,60);
		this.w = size;
		this.h = size;
		this.x = rand(0,canvasWidth-size);
		this.y = rand(0,canvasHeight-size);

		this.color = "green";
	}
	Food.prototype.draw = function() {
		ctx.fillStyle = this.color;
		ctx.fillRect(this.x, this.y, this.w, this.h);
	};
	Food.prototype.setPosition = function (){
		this.x = rand(0,canvasWidth-this.w);
		this.y = rand(0,canvasHeight-this.w);
	}

	var foodObj = new Food();
	function clearTimer(){
		var end = setTimeout(function(){},1);
		var start = (end -100)>0?end-100:0;
		for(var i=start;i<=end;i++){
		    clearTimeout(i);
		}
	}
	function draw(){
		ctx.clearRect(0, 0, canvasWidth, canvasHeight);
		
		
		snake.move();
		snake.draw(); 
		
		//跟食物的碰撞
		if (collide(snake,foodObj)){
			snake.removeBody = false;
			foodObj.setPosition();
		}

		foodObj.draw();

		//跟身体的碰撞
		for (var i=0; i<snake.bodys.length-1; i++){
			
			if (collide(snake,snake.bodys[i])){
				console.log(snake,snake.bodys[i])
				alert("吃到身体啦,游戏结束啦");
				clearTimer();
				return true;
			}
		}
	}

	function main(){
		
		timer = setInterval(function(){

			draw();
		},snake.speed)
	}
	main();

	document.onkeydown = function (ev){



		switch (ev.keyCode){

			case 37:
				if (snake.l||snake.r){
					return;
				}
				if (!snake.r){
					
					snake.l = true;
					snake.r = false;
					snake.t = false;
					snake.b = false;
				}
				break;
			case 38:
				if (snake.t||snake.b){
					return;
				}
				if (!snake.b){
					
					snake.l = false;
					snake.r = false;
					snake.t = true;
					snake.b = false;
				}
				break;
			case 39:
				if (snake.r||snake.l){
					return;
				}
				if (!snake.l){
					
					snake.l = false;
					snake.r = true;
					snake.t = false;
					snake.b = false;
				}
				
				break;
			case 40:
				if (snake.t||snake.b){
					return;
				}
				if (!snake.t){
					
					snake.l = false;
					snake.r = false;
					snake.t = false;
					snake.b = true;
				}
				break;
		}
		if (ev.keyCode==37||ev.keyCode==38||ev.keyCode==39||ev.keyCode==40){
			clearTimer();

			timer = setInterval(function(){

				draw();
			},snake.speed)
			draw();
		}
		
		
	}








</script>
</html>